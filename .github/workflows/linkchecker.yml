on: [pull_request]
name: Check Markdown links for modified files
jobs:
  vercel-deployment-poll:
    runs-on: ubuntu-latest
    timeout-minutes: 3 #cancel job if no deployment is found
    continue-on-error: true
    outputs:
      url: ${{ steps.waitForVercelPreviewDeployment.outputs.url }}
    steps:
    - name: Wait for Vercel preview deployment to be ready
      uses: patrickedqvist/wait-for-vercel-preview@master
      id: waitForVercelPreviewDeployment
      with:
       token: ${{ secrets.GITHUB_TOKEN }}
       max_timeout: 600 # in seconds, set really high to leverage job timeout-minutes values
  markdown-link-check:
    needs: vercel-deployment-poll
    runs-on: ubuntu-latest
    steps:
    - name: Set Deployment URL Env
      run:
        echo "DEPLOYMENT_URL=${{ needs.vercel-deployment-poll.outputs.url }}" >> $GITHUB_ENV
    - name: Checkout source branch
      uses: actions/checkout@master
    - name: Check links
      uses: gaurav-nelson/github-action-markdown-link-check@v1
      with:
        use-quiet-mode: 'yes'
        file-extension: 'mdx'
        check-modified-files-only: 'yes'
        folder-path: 'website/content'
